{% extends 'main/base.html' %}
{% block title %}{{ activity.title }}{% endblock %}
{% block content %}
<p class="text-muted">
    You have viewed this activity {{ session_activity_visits }} times in this session.
</p>

<h2>{{ activity.title }}</h2>
<div class="mb-3">
    <span class="badge bg-success me-2">{{ activity.category }}</span>
    {% if activity.created_by.profile.is_organizer %}
        <span class="badge bg-warning text-dark">
            <i class="bi bi-shield-check me-1"></i>Official Event
        </span>
    {% endif %}
</div>
{% if activity.created_by.profile.is_organizer and activity.created_by.profile.organization_name %}
    <p class="text-muted">
        <i class="bi bi-building me-1"></i><strong>Organized by:</strong> {{ activity.created_by.profile.organization_name }}
    </p>
{% endif %}
<p><strong>Location:</strong> {{ activity.location }}</p>
<p><strong>Date:</strong> {{ activity.date }}</p>
<p><strong>Hosted by:</strong> {{ activity.created_by.username }}</p>
<p>{{ activity.description }}</p>

<hr>

<h4>Media Gallery</h4>
<div class="row g-3">
  {% for m in media_items %}
    <div class="col-md-3">
      {% if m.is_image %}
        <img src="{{ m.file.url }}" alt="" class="img-fluid rounded">
      {% elif m.is_video %}
        <video src="{{ m.file.url }}" controls class="img-fluid rounded"></video>
      {% else %}
        <a href="{{ m.file.url }}" target="_blank">Download file</a>
      {% endif %}
    </div>
  {% empty %}
    <p>No media uploaded yet.</p>
  {% endfor %}
</div>

{% if user.is_authenticated %}
  <hr>
  <h5>Upload a new image or video</h5>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ media_form.file }}
    <button type="submit" class="btn btn-success mt-2">Upload</button>
  </form>
{% else %}
  <p class="mt-3">Please <a href="{% url 'login' %}">log in</a> to upload media.</p>
{% endif %}

{% endblock %}
